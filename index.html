<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pink Secret</title>
<style>
:root{
Â Â --bg:#0b0c10; --card:#15161b; --muted:#9aa4b5; --text:#eef2f7; --brand:#ff4fb0; --line:#242935; --ok:#20c997;
}
*{box-sizing:border-box}
body{margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif; background:var(--bg); color:var(--text);}
header{position:sticky; top:0; z-index:2; background:linear-gradient(180deg, #0b0c10, rgba(11,12,16,.7)); border-bottom:1px solid var(--line)}
.wrap{max-width:1100px; margin:auto; padding:12px 16px; display:flex; align-items:center; gap:12px}
.logo{display:flex; align-items:center; gap:10px; font-weight:800}
.logo img{width:28px; height:28px; border-radius:50%}
main{max-width:1100px; margin:22px auto; padding:0 16px}
.grid{display:grid; grid-template-columns:repeat(4,1fr); gap:18px}
.card{background:var(--card); border:1px solid var(--line); border-radius:14px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.25)}
.card img{width:100%; height:210px; object-fit:cover; display:block}
.pad{padding:12px}
.pill{display:inline-block; padding:2px 8px; font-size:12px; border-radius:999px; background:#1f2230; color:#b9c0cc}
.title{font-weight:800; margin-top:6px}
.muted{color:var(--muted); font-size:13px}
.price{color:var(--ok); font-weight:900}
.row-right{display:flex; justify-content:flex-end; gap:8px; margin-top:10px}
.btn{padding:10px 14px; border-radius:10px; border:1px solid var(--line); background:#202433; color:var(--text); cursor:pointer}
.btn.primary{background:var(--brand); border-color:#ff4fb0; color:#190713; font-weight:700}
.cart-btn{margin-left:auto}
.sheet{position:fixed; inset:auto 0 0 0; background:var(--card); border-top:1px solid var(--line); transform:translateY(110%); transition:.25s; z-index:5; max-height:75vh; overflow:auto}
.sheet.show{transform:translateY(0)}
.row-between{display:flex; justify-content:space-between; align-items:center; gap:8px}
.items .item{display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center; padding:10px 0; border-bottom:1px dashed #2a2f40}
.items img{width:60px; height:60px; object-fit:cover; border-radius:8px; border:1px solid #2a2f40}
.qty button{width:26px; height:26px; border-radius:6px; border:1px solid var(--line); background:#202433; color:var(--text); cursor:pointer}
.total{font-weight:900; color:var(--ok)}
@media (max-width:900px){ .grid{grid-template-columns:repeat(2,1fr)} }
/* ========= å·¦ä¾§æŠ½å±‰å¼è´­ç‰©è½¦ï¼ˆæ›¿æ¢æ—§çš„ #cart.sheet æ ·å¼ï¼‰ ========= */
#cart.sheet{
  position: fixed;
  top: 0;
  left: 0;                 /* å·¦ä¾§æŠ½å±‰ */
  right: auto;
  width: min(88vw, 440px); /* æ‰‹æœºå‹å¥½ï¼Œæœ€å¤§ 440px */
  height: 100dvh;          /* å æ»¡å±ï¼ˆæ”¯æŒç§»åŠ¨ç«¯ address barï¼‰ */
  background: #111;        /* ä½ è¦çš„æ·±è‰²èƒŒæ™¯ï¼ˆæ¢å›ç™½è‰²ç”¨ #fffï¼‰ */
  color: #eee;
  box-shadow: 4px 0 18px rgba(0,0,0,.35);
  transform: translateX(-100%);      /* é»˜è®¤éšè—åœ¨å·¦ä¾§ */
  transition: transform .3s ease;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  border-radius: 0;        /* èœå•æ ·å¼ï¼Œä¸è¦åœ†è§’ */
  overflow: hidden;        /* ç¦æ­¢æ¨ªå‘æº¢å‡º */
}

#cart.sheet.show{
  transform: translateX(0);           /* æ˜¾ç¤ºæ—¶æ»‘å‡º */
}

/* é®ç½©å±‚ï¼ˆç‚¹å‡»å¯å…³é—­ï¼‰ */
#cartMask{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  backdrop-filter: blur(2px);
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s ease;
  z-index: 9998;
}
#cartMask.show{
  opacity: 1;
  pointer-events: auto;
}

/* å¤´éƒ¨ */
#cart .wrap{
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px 14px 12px;
  height: 100%;
  overflow-y: auto;     /* åªç«–å‘æ»šåŠ¨ */
  overflow-x: hidden;   /* ç¦æ¨ªå‘æ»šåŠ¨ */
}
#cart .row-between{ 
  display: flex; 
  justify-content: space-between; 
  align-items: center;
  gap: 10px;
}
#cart .row-between .title{
  font-weight: 800;
  font-size: 18px;
  color: #dcd1ff;       /* æ ‡é¢˜å¾®ç´«ï¼ˆæ¥è¿‘é»‘å¯ç”¨ #1a0b2e æˆ– #0a0711ï¼‰ */
}

/* å•†å“åˆ—è¡¨ */
#cart .items{ 
  display: flex; 
  flex-direction: column; 
  gap: 8px; 
}
#cart .items .item{
  display: grid;
  grid-template-columns: 64px 1fr auto;
  align-items: center;
  gap: 10px;
  padding: 10px 6px;
  background: rgba(255,255,255,.03);
  border: 1px solid rgba(255,255,255,.06);
  border-radius: 10px;
}
#cart .items .item img{
  width: 64px; height: 64px; object-fit: cover;
  border-radius: 8px; border: 1px solid rgba(255,255,255,.15);
}
#cart .items .item .meta{
  display: flex; flex-direction: column; gap: 4px;
  min-width: 0;          /* é˜²æ­¢æ–‡æœ¬æ’‘å®½å¯¼è‡´æ¨ªå‘æ»šåŠ¨ */
}
#cart .items .item .meta .name{
  font-weight: 700; 
  color: #f5f5f7; 
  line-height: 1.2;
  white-space: nowrap; 
  overflow: hidden; 
  text-overflow: ellipsis;
}
#cart .items .item .meta .muted{
  color: #aaa7bd; font-size: 12px;
}

#cart .items .item .right{
  display: flex; align-items: center; gap: 10px;
}
#cart .qty{
  display: flex; align-items: center; gap: 8px;
}
#cart .qty button{
  width: 28px; height: 28px; border-radius: 8px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.08);
  color: #eee; font-weight: 700;
  line-height: 28px; text-align: center;
  cursor: pointer;
}
#cart .price{
  min-width: 88px;
  text-align: right; font-weight: 800;
  color: #ff6aa4;          /* å•é¡¹ä»·æ ¼ */
}

/* åº•éƒ¨æ±‡æ€»å›ºå®šåœ¨åº• */
#cart .footer{
  position: sticky;
  bottom: 0;
  left: 0; right: 0;
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  padding: 12px 14px 14px;
  background: linear-gradient(to top, rgba(0,0,0,.75), rgba(0,0,0,.35));
  border-top: 1px solid rgba(255,255,255,.08);
}
#cart .footer .sum{
  display: grid; gap: 6px; 
  color: #eae6ff;
}
#cart .footer .sum .line{
  display: flex; justify-content: space-between; align-items: center;
  font-size: 14px;
}
#cart .footer .sum .total{
  font-weight: 800; font-size: 18px; color: #ffd8ec;
}

/* æŒ‰é’® */
#cart .btn{
  padding: 10px 14px; border-radius: 12px;
  border: 1px solid rgba(255,255,255,.16);
  background: #202433; color: #fff; cursor: pointer;
}
#cart .btn.primary{
  background: #ff2d8c;
  border-color: #ff2d8c;
  color: #fff; font-weight: 800;
  min-width: 120px; text-align: center;
}

/* å…³é—­æŒ‰é’®å¤–è§‚ï¼ˆå¯æ²¿ç”¨ä½ ç°æœ‰çš„ #cClose.btnï¼‰ */
#cClose.btn{ background:#111; color:#fff; border-radius: 10px; }
 /* åˆ é™¤æŒ‰é’®é€šç”¨æ ·å¼ */
    .delete-btn {
      background: none;
      border: none;
      color: #ff4d4f; /* çº¢è‰²åƒåœ¾æ¡¶ */
      font-size: 16px;
      cursor: pointer;
      margin-left: 12px; /* å’Œæ•°é‡æŒ‰é’®ä¿æŒé—´è· */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .delete-btn:hover {
      color: #ff1a1a;
      transform: scale(1.2);
    }

    /* æ•°é‡å’Œåˆ é™¤æŒ‰é’®çš„å®¹å™¨ */
    .qty {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 6px; /* æ§åˆ¶é—´è· */
    }
</style>
</head>
<body>
<header>
Â Â <div class="wrap">
Â Â Â Â <div class="logo">
Â Â Â Â Â Â <img src="https://i.postimg.cc/3NNt56LQ/pink.png" alt="Pink Secret">
Â Â Â Â Â Â Pink Secret
Â Â Â Â </div>
Â Â Â Â <input id="search" type="search" placeholder="Search: name / type / description..." style="flex:1; max-width:440px; padding:9px 12px; border-radius:10px; border:1px solid var(--line); background:#0f1119; color:var(--text)"/>
Â Â Â Â <button id="openCart" class="btn cart-btn">Cart</button>
Â Â </div>
</header>

<main>
Â Â <div id="grid" class="grid"></div>
</main>

<!-- Cart Sheet -->
<aside id="cart" class="sheet" aria-hidden="true">
Â Â <div class="wrap" style="padding-top:16px; padding-bottom:18px">
Â Â Â Â </div>

Â Â Â Â <!-- å¤´éƒ¨ -->
<div class="row-between">
  <div class="title">Shopping Cart</div>
  <button id="cClose" class="btn">Close</button>
</div>

<!-- åˆ—è¡¨ -->
<div id="cartList" class="items"></div>

<!-- åº•éƒ¨æ±‡æ€»ï¼ˆå›ºå®šåœ¨åº•ï¼‰ -->
<div class="footer">
  <div class="sum">
    <div class="line"><span>Subtotal</span><span id="cSub">RM 0.00</span></div>
    <div class="line"><span>Items</span><span id="cartCount">0</span></div>
    <div class="line total"><span>Total</span><span id="cTotal">RM 0.00</span></div>
  </div>
  <a id="goCheckout" href=" " class="btn primary">Pay</a >
</div>
</aside>
<div id="cartMask" class="mask"></div>
<script>
(function(){
Â Â // ---------- 1 Products fixed prices ----------
Â Â const IMG = {
Â Â Â Â 1:'https://i.postimg.cc/vBZGYsSD/babydoll01.jpg',
Â Â Â Â 2:'https://i.postimg.cc/wjYHtJbC/chemise02.jpg',
Â Â Â Â 3:'https://i.postimg.cc/3RqQ3Dvb/bralette03.jpg',
Â Â Â Â 4:'https://i.postimg.cc/wxS3V1GV/corset04.jpg',
Â Â Â Â 5:'https://i.postimg.cc/6pK3kDw4/teddy05.jpg',
Â Â Â Â 6:'https://i.postimg.cc/0Qz2GvGF/babydoll06.jpg',
Â Â Â Â 7:'https://i.postimg.cc/k4LMfHf4/bralette07.jpg',
Â Â Â Â 8:'https://i.postimg.cc/L6K6PrJQ/garterset08.jpg',
Â Â Â Â 9:'https://i.postimg.cc/bwqyCkHQ/chemise09.jpg',
Â Â Â Â 10:'https://i.postimg.cc/j5ntwXtr/robe10.jpg',
Â Â Â Â 11:'https://i.postimg.cc/hv9nMtXy/bikiniset11.jpg',
Â Â Â Â 12:'https://i.postimg.cc/90j54HLG/teddy12.jpg',
Â Â Â Â 13:'https://i.postimg.cc/zG2sCgdD/babydoll13.jpg',
Â Â Â Â 14:'https://i.postimg.cc/DztRDKkt/corset14.jpg',
Â Â Â Â 15:'https://i.postimg.cc/x1ZZJSCc/bralette15.jpg',
Â Â Â Â 16:'https://i.postimg.cc/3RXfc4Zv/chemise16.jpg',
Â Â Â Â 17:'https://i.postimg.cc/RhGsvkyC/robe17.jpg',
Â Â Â Â 18:'https://i.postimg.cc/pTJkZN2Q/teddy18.jpg',
Â Â Â Â 19:'https://i.postimg.cc/Vs4D0cZm/garterset19.jpg',
Â Â Â Â 20:'https://i.postimg.cc/7ZJVRJHZ/bikiniset20.jpg'
Â Â };

Â Â const DESC = {
Â Â Â Â 1:'Silky chiffon babydoll with lace trim and satin bow.',
Â Â Â Â 2:'Soft satin chemise with delicate lace and adjustable straps.',
Â Â Â Â 3:'Lightweight bralette, breathable mesh, comfy all day.',
Â Â Â Â 4:'Classic corset with boning support and lace-up back.',
Â Â Â Â 5:'Flirty teddy with sheer panels and scalloped lace.',
Â Â Â Â 6:'Romantic babydoll with tulip hem and matching thong.',
Â Â Â Â 7:'Ribbed bralette, no underwire, flexible and soft.',
Â Â Â Â 8:'Garter set with stockingsâ€”vintage vibe, modern fit.',
Â Â Â Â 9:'Satin chemise with side slits and V-neck lace.',
Â Â Â Â 10:'Flowy robe with belt tie, semi-sheer drape.',
Â Â Â Â 11:'Bikini set, quick-dry fabric, cheeky coverage.',
Â Â Â Â 12:'Velvet teddy with mesh cutouts and snap closure.',
Â Â Â Â 13:'Lace babydoll with keyhole back and soft cups.',
Â Â Â Â 14:'Brocade corset, steel hooks, dramatic waistline.',
Â Â Â Â 15:'Seamless bralette, ultra-soft, everyday comfort.',
Â Â Â Â 16:'Slip chemise with eyelash lace hem and straps.',
Â Â Â Â 17:'Sheer chiffon robe, light and elegant.',
Â Â Â Â 18:'Fishnet teddy with stretch fit and open back.',
Â Â Â Â 19:'Lace garter set with adjustable clips.',
Â Â Â Â 20:'Triangle bikini setâ€”stretchy, supportive, sleek.'
Â Â };

Â Â // Fixed prices RM)
Â Â const PRICE = {
Â Â Â Â 1:820,2:740,3:560,4:900,5:650,6:780,7:590,8:870,9:720,10:690,
Â Â Â Â 11:630,12:810,13:700,14:880,15:540,16:760,17:600,18:680,19:840,20:620
Â Â };

Â Â const PRODUCTS = [
Â Â Â Â {id:1, name:'Babydoll Mist Pink', type:'Babydoll', img:IMG[1],Â Â price:PRICE[1],Â Â desc:DESC[1]},
Â Â Â Â {id:2, name:'Chemise Soft Blue', type:'Chemise', img:IMG[2],Â Â price:PRICE[2],Â Â desc:DESC[2]},
Â Â Â Â {id:3, name:'Bralette Nude', type:'Bralette', img:IMG[3],Â Â price:PRICE[3],Â Â desc:DESC[3]},
Â Â Â Â {id:4, name:'Corset Dark Red', type:'Corset', img:IMG[4],Â Â price:PRICE[4],Â Â desc:DESC[4]},
Â Â Â Â {id:5, name:'Teddy Sexy Blue', type:'Teddy', img:IMG[5],Â Â price:PRICE[5],Â Â desc:DESC[5]},
Â Â Â Â {id:6, name:'Babydoll Peach', type:'Babydoll', img:IMG[6],Â Â price:PRICE[6],Â Â desc:DESC[6]},
Â Â Â Â {id:7, name:'Bralette Pink', type:'Bralette', img:IMG[7],Â Â price:PRICE[7],Â Â desc:DESC[7]},
Â Â Â Â {id:8, name:'Garter Set Black', type:'Garter set', img:IMG[8],Â Â price:PRICE[8],Â Â desc:DESC[8]},
Â Â Â Â {id:9, name:'Chemise Black', type:'Chemise', img:IMG[9],Â Â price:PRICE[9],Â Â desc:DESC[9]},
Â Â Â Â {id:10, name:'Robe Ink', type:'Robe', img:IMG[10], price:PRICE[10], desc:DESC[10]},
Â Â Â Â {id:11, name:'Bikini Set Blue', type:'Bikini set', img:IMG[11], price:PRICE[11], desc:DESC[11]},
Â Â Â Â {id:12, name:'Teddy Velvet', type:'Teddy', img:IMG[12], price:PRICE[12], desc:DESC[12]},
Â Â Â Â {id:13, name:'Babydoll Random Clour', type:'Babydoll', img:IMG[13], price:PRICE[13], desc:DESC[13]},
    {id:14, name:'Corset Black', type:'Corset', img:IMG[14], price:PRICE[14], desc:DESC[14]},
Â Â Â Â {id:15, name:'Bralette Pink', type:'Bralette', img:IMG[15], price:PRICE[15], desc:DESC[15]},
Â Â Â Â {id:16, name:'Chemise Pink', type:'Chemise', img:IMG[16], price:PRICE[16], desc:DESC[16]},
Â Â Â Â {id:17, name:'Robe White Blue', type:'Robe', img:IMG[17], price:PRICE[17], desc:DESC[17]},
Â Â Â Â {id:18, name:'Teddy Black', type:'Teddy', img:IMG[18], price:PRICE[18], desc:DESC[18]},
Â Â Â Â {id:19, name:'Garter Set Red Black', type:'Garter set', img:IMG[19], price:PRICE[19], desc:DESC[19]},
Â Â Â Â {id:20, name:'Bikini Set Black', type:'Bikini set', img:IMG[20], price:PRICE[20], desc:DESC[20]}
Â Â ];

Â Â // ---------- 2) UI elements ----------
Â Â const gridÂ Â Â = document.getElementById('grid');
Â Â const search = document.getElementById('search');
Â Â const cartÂ Â Â = document.getElementById('cart');
Â Â const cartMask = document.getElementById('cartMask');
Â Â const openCart = document.getElementById('openCart');
Â Â const cClose = document.getElementById('cClose');
Â Â const cartList = document.getElementById('cartList');
Â Â const cSubÂ Â Â = document.getElementById('cSub');
Â Â const cartCount = document.getElementById('cartCount');
  const cTotal = document.getElementById('cTotal');

Â Â // ---------- 3) Cart data ----------
Â Â let CART = loadCart();
Â Â function loadCart(){ 
    try{ return JSON.parse(localStorage.getItem('PS_CART')) || []; 
    }
    catch(e){ return []; } 
}
Â Â function saveCart(){ 
    localStorage.setItem('PS_CART', JSON.stringify(CART)); 
}

// === Cart storage helpers ===
const CART_KEY = 'PS_CART';

function readCart() {
  try {
    return JSON.parse(localStorage.getItem(CART_KEY)) || [];
  } catch (e) {
    return [];
  }
}

function saveCart(cart) {
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
}

// åŠ å…¥è´­ç‰©è½¦ï¼ˆè‹¥å·²å­˜åœ¨åˆ™ qty+1ï¼‰
function addToCart(id) {
  const cart = readCart();                // è¯»ç°æœ‰è´­ç‰©è½¦
  const numId = Number(id);
  let item = cart.find(x => x.id === numId);

  if (item) {
    item.qty += 1;
  } else {
    cart.push({ id: numId, qty: 1 });
  }

  saveCart(cart);                         // å†™å› localStorage
  updateCartUI();                         // åˆ·æ–°å³ä¾§è´­ç‰©è½¦ UIï¼ˆcSub/cTotal/cnt ç­‰ï¼‰
}

Â Â // ---------- 4) Render product card ----------
Â function productCard(p){
  const card = document.createElement('article');
  card.className = 'card';

  const img = document.createElement('img');
  img.src = p.img;
  img.alt = p.name;
  img.loading = 'lazy';
  card.appendChild(img);

  const pad = document.createElement('div');
  pad.className = 'pad';
  card.appendChild(pad);

  // ç¬¬ä¸€è¡Œï¼špill + price
  const row1 = document.createElement('div');
  row1.className = 'row-between';

  const pill = document.createElement('div');
  pill.className = 'pill';
  pill.textContent = `Women Â· ${p.type}`;

  const price = document.createElement('div');
  price.className = 'price';
  price.textContent = `RM ${p.price.toFixed(2)}`;

  row1.append(pill, price);
  pad.appendChild(row1);

  // æ ‡é¢˜
  const title = document.createElement('div');
  title.className = 'title';
  title.style.marginTop = '6px';
  title.textContent = p.name;
  pad.appendChild(title);

  // æè¿°
  const muted = document.createElement('div');
  muted.className = 'muted';
  muted.style.marginTop = '6px';
  muted.textContent = p.desc || '';
  pad.appendChild(muted);

  // æŒ‰é’®è¡Œ
  const rowR = document.createElement('div');
  rowR.className = 'row-right';
  rowR.style.marginTop = '10px';

  const btnDetail = document.createElement('button');
  btnDetail.className = 'btn';
  btnDetail.dataset.act = 'detail';
  btnDetail.dataset.id = p.id;
  btnDetail.textContent = 'Details';

  const btnAdd = document.createElement('button');
  btnAdd.className = 'btn primary';   // â† å†ä¹Ÿä¸ä¼šå› ä¸ºå¼•å·æŠ¥é”™
  btnAdd.dataset.act = 'add';
  btnAdd.dataset.id = p.id;
  btnAdd.style.marginLeft = '8px';
  btnAdd.textContent = 'Add to Cart';

  rowR.append(btnDetail, btnAdd);
  pad.appendChild(rowR);

  return card;
}

Â Â // ---------- 5) Render list ----------
Â function render () {
  const gridEl = document.getElementById('grid');   // â† ç»Ÿä¸€ç”¨è¿™ä¸ª
  const q   = (search.value || '').trim().toLowerCase();
  const list = q
    ? PRODUCTS.filter(x => (x.name + x.type + x.desc).toLowerCase().includes(q))
    : PRODUCTS;

  gridEl.innerHTML = '';
  list.forEach(p => gridEl.appendChild(productCard(p)));
}
Â Â search.addEventListener('input', render);

Â Â // ---------- 6) Cart ops ----------
Â Â // åŠ å…¥è´­ç‰©è½¦ï¼ˆid ä¸ºæ•°å­—æˆ–å­—ç¬¦ä¸²éƒ½å¯ï¼‰
// æ”¹å˜æ•°é‡/åˆ é™¤
function changeQTY(id, delta) {
  const cart = loadCart();
  const nid = Number(id);
  const it = cart.find(x => x.id === nid);
  if (!it) return;
  it.qty += delta;
  if (it.qty <= 0) {
    const i = cart.indexOf(it);
    cart.splice(i, 1);
  }
  saveCart(cart);
  updateCartUI();
}
Â Â function changeQty(id, d){
Â Â Â Â const it = CART.find(x=>x.id===id); if(!it) return;
Â Â Â Â it.qty += d; if(it.qty<=0) CART = CART.filter(x=>x.id!==id);
Â Â Â Â saveCart(); updateCartUI();
Â Â }
Â Â function removeItem(id){
Â Â Â Â CART = CART.filter(x=>x.id!==id); saveCart(); updateCartUI();
Â Â }

Â Â function RM(n){ return 'RM ' + (+n).toFixed(2); }

// åˆ·æ–°è´­ç‰©è½¦ UIï¼ˆåˆ—è¡¨/å°è®¡/åˆè®¡/ä»¶æ•°ï¼‰
function updateCartUI() {
  const cart = loadCart();

  const listEl  = document.getElementById('cartList');
  const subEl   = document.getElementById('cSub');
  const totEl   = document.getElementById('cTotal');
  const cntEl   = document.getElementById('cartCount');

  if (!listEl || !subEl || !totEl || !cntEl) return; // ç¼ºä»»ä½•ä¸€ä¸ªå°±å…ˆé€€å‡º

  listEl.innerHTML = '';
  let subtotal = 0;
  let count = 0;

  cart.forEach(it => {
    const p = PRODUCTS.find(x => x.id === it.id);
    if (!p) return;
    const line = p.price * it.qty;
    subtotal += line;
    count += it.qty;

    // ä¸€æ¡è´­ç‰©è½¦è¡Œ
    const row = document.createElement('div');
    row.className = 'item';
    row.innerHTML =
      '<img src="' + p.img + '" alt="' + p.name + '">' +
      '<div>' +
      '  <div style="font-weight:800">' + p.name + '</div>' +
      '  <div class="muted">Women Â· ' + p.type + '</div>' +
      '</div>' +
      '<div style="text-align:right">' +
      '  <div class="price">' + RM(line) + '</div>' +
      '  <div class="qty" style="margin-top:6px">' +
      '    <button aria-label="minus" data-act="m" data-id="' + p.id + '">-</button>' +
      '    <span style="display:inline-block;width:28px;text-align:center">' + it.qty + '</span>' +
      '    <button aria-label="plus" data-act="p" data-id="' + p.id + '">+</button>' +
      '    <button class="btn" style="margin-left:8px" data-act="d" data-id="' + p.id + '">ğŸ—‘ï¸</button>' +
      '  </div>' +
      '</div>';
      // è¡Œå†…äº‹ä»¶
    row.querySelector('[data-act="m"]').onclick = () => changeQTY(it.id, -1);
    row.querySelector('[data-act="p"]').onclick = () => changeQTY(it.id,  1);
    row.querySelector('[data-act="d"]').onclick = () => changeQTY(it.id, -999);

    listEl.appendChild(row);
  });

  subEl.textContent = RM(subtotal);
  totEl.textContent = RM(subtotal);   // é¦–é¡µå…ˆç­‰äºå°è®¡
  cntEl.textContent = count;
}

openCart.onclick = () => {
  cart.classList.add('show');
  updateCartUI();          // â† è¿™é‡Œè¦æœ‰åˆ†å·
};

cClose.onclick = () => {
  cart.classList.remove('show');
};

cartMask.onclick = cClose.onclick;

document.getElementById('goCheckout').addEventListener('click', function (e) {
    e.preventDefault();

    const items = (window.CART || []).map(it => {
      const p = (window.PRODUCTS || []).find(x => x.id === it.id);
      if (!p) return null;
      return { id: p.id, name: p.name, img: p.img, price: p.price, qty: it.qty };
    }).filter(Boolean);

    localStorage.setItem('PS_ORDER_ITEMS', JSON.stringify(items));
    location.href = 'payment2.html';
  });

Â Â // ---------- 8) Snapshot for checkout ----------
Â Â function snapshotOrder(){
Â Â Â Â const items = CART.map(it=>{
Â Â Â Â Â Â const p = PRODUCTS.find(x=>x.id===it.id); if(!p) return null;
Â Â Â Â Â Â return { id:p.id, name:p.name, img:p.img, price:p.price, qty:it.qty };
Â Â Â Â }).filter(Boolean);
Â Â Â Â localStorage.setItem('PS_ORDER_ITEMS', JSON.stringify(items));
Â Â Â Â // æ¸…ç†æ—§ totalsï¼Œç¡®ä¿åç»­ç»Ÿä¸€
Â Â Â Â localStorage.removeItem('PS_ORDER_TOTALS');
Â Â Â Â localStorage.removeItem('PS_SHIP');
Â Â }

// ç»Ÿä¸€ç›‘å¬æ‰€æœ‰ Add to Cart æŒ‰é’®
document.addEventListener('click', (e) => {
  const btn = e.target.closest('button, a');
  if (!btn) return;

  // å•†å“å¡ç‰‡ä¸Šçš„ â€œAdd to Cartâ€ æŒ‰é’®
  if (btn.dataset && btn.dataset.act === 'add' && btn.dataset.id) {
      console.count('[add] called');
    addToCart(btn.dataset.id);
    const cartEl = document.getElementById('cart');
    if (cartEl && cartEl.classList) cartEl.classList.add('show');
  }
});
Â // -------- 9) boot (safe) --------
function safeBoot() {
  try {
    console.log('[BOOT] startingâ€¦',
      { hasProducts: typeof PRODUCTS !== 'undefined',
        hasCart: typeof CART !== 'undefined',
        hasRender: typeof render === 'function',
        hasUpdateUI: typeof updateCartUI === 'function' });

    if (typeof render === 'function') render();
    if (typeof updateCartUI === 'function') updateCartUI();

    const goBtn = document.getElementById('goCheckout');
    if (goBtn) goBtn.addEventListener('click', snapshotOrder);

    console.log('[BOOT] ok');
  } catch (e) {
    console.error('[BOOT ERROR]', e);
    document.body.insertAdjacentHTML(
      'beforeend',
      `<pre id="dbg" style="background:#200;color:#f88;padding:12px;white-space:pre-wrap;border:1px solid #400;">
[BOOT ERROR]
${e.stack || e}
</pre>`
    );
  }
}
// ç»Ÿä¸€ç›‘å¬å•†å“åŒºæ‰€æœ‰æŒ‰é’®ï¼ˆåªåŠ å…¥ï¼Œä¸å¼¹å‡ºè´­ç‰©è½¦ï¼‰
document.getElementById('grid').addEventListener('click', (e) => {
  const btn = e.target.closest('button[data-act]');
  if (!btn) return;                          // ä¸æ˜¯æŒ‰é’®ï¼Œå¿½ç•¥

  const id  = Number(btn.dataset.id);
  const act = btn.dataset.act;

  if (act === 'add') {
    addToCart(id);                           // åŠ å…¥è´­ç‰©è½¦
    updateCartUI();                          // åˆ·æ–°æ•°é‡/å°è®¡ï¼ˆä¸æ‰“å¼€æŠ½å±‰ï¼‰
    if (typeof updateCartBadge === 'function') updateCartBadge(); // å¯é€‰ï¼šå³ä¸Šè§’å¾½æ ‡
  }

  if (act === 'detail') {
    openDetail(id);
  }
});

// ä¿ç•™ä½ çš„å¯åŠ¨é€»è¾‘
window.addEventListener('DOMContentLoaded', safeBoot);
 // ä¿é™©ï¼šç­‰ DOM å°±ç»ªå†ç»‘å®š
  window.addEventListener('DOMContentLoaded', () => {
    const cartEl   = document.getElementById('cart');     // ä¾§æ 
    const openCart = document.getElementById('openCart'); // é¡¶éƒ¨æŒ‰é’®
    const cClose   = document.getElementById('cClose');   // å…³é—­æŒ‰é’®
    const cartMask = document.getElementById('cartMask'); // é®ç½©ï¼ˆå¦‚æœæœ‰ï¼‰

    // å¦‚æœæ‰¾ä¸åˆ°å…ƒç´ ï¼Œæ‰“å°æç¤ºï¼Œæ–¹ä¾¿ä½ çœ‹ Console
    console.log('[Cart bind]', {cartEl: !!cartEl, openCart: !!openCart, cClose: !!cClose, cartMask: !!cartMask});

    // ç»Ÿä¸€çš„â€œç¨³å¥ç»‘å®šâ€ï¼ˆæ—¢æœ‰ç›´ç»‘ï¼Œä¹Ÿæœ‰äº‹ä»¶å§”æ‰˜ä½œä¸ºå…œåº•ï¼‰
    function showCart(e){
      if (!cartEl) return;
      cartEl.classList.add('show');
      e && e.preventDefault();
      e && e.stopPropagation();
    }
    function hideCart(e){
      if (!cartEl) return;
      cartEl.classList.remove('show');
      e && e.preventDefault();
      e && e.stopPropagation();
    }

    // ç›´ç»‘
    if (openCart) openCart.addEventListener('click', showCart);
    if (cClose)   cClose.addEventListener('click', hideCart);
    if (cartMask) cartMask.addEventListener('click', hideCart);

    // å…œåº•ï¼šäº‹ä»¶å§”æ‰˜ï¼ˆå³ä½¿ä»¥åæŒ‰é’®è¢«é‡æ¸²æŸ“ä¹Ÿèƒ½ç‚¹ï¼‰
    document.addEventListener('click', (e) => {
      if (e.target.closest('#openCart')) showCart(e);
      if (e.target.closest('#cClose') || e.target.closest('#cartMask')) hideCart(e);
    });
  });
})();
// ===== ç»Ÿä¸€çš„ Add to Cart äº‹ä»¶å§”æ‰˜ï¼ˆåªç»‘å®šä¸€æ¬¡ï¼‰=====
(function bindAddOnce(){
  if (window.__boundAddToCart) return;        // é˜²æ­¢é‡å¤ç»‘å®š
  window.__boundAddToCart = true;

  document.addEventListener('click', (e) => {
    const btn = e.target.closest('button, a');
    if (!btn) return;

    // åªå¤„ç†å¸¦ data-act çš„æŒ‰é’®
    const act = btn.dataset?.act;
    const id  = btn.dataset?.id;

    if (act === 'add' && id != null) {
      console.count('[add] fired');           // è°ƒè¯•ï¼šåº”åªé€’å¢ 1,2,3...
      addToCart(Number(id));                  // çœŸæ­£åŠ è½¦
      updateCartUI?.();                       // é‡ç»˜è´­ç‰©è½¦ï¼ˆå¯é€‰ï¼‰
      // ä¸è‡ªåŠ¨å¼¹å‡ºè´­ç‰©è½¦çš„è¯ï¼Œä¿ç•™è¿™è¡Œä¸ºç©ºå³å¯
      // document.getElementById('cart')?.classList.add('show');
    }

    if (act === 'detail' && id != null) {
      openDetail?.(Number(id));
    }
  });
})();
</script>
</body>
</html>
